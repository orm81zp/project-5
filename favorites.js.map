{"version":3,"file":"favorites.js","sources":["../src/js/favorites.js"],"sourcesContent":["import Api from './api';\nimport { LOCAL_STORAGE_KEY, UPDATE_LOCAL_STORAGE_EVENT } from './const';\nimport {\n  clearContent,\n  getClosest,\n  renderByExercises,\n  showLoader,\n} from './utils';\n\n(() => {\n  const favoritesWrapper = document.querySelector('.favorites');\n  if (!favoritesWrapper) {\n    return;\n  }\n\n  const state = {\n    exercisesIds: [],\n  };\n\n  state.exercisesIds =\n    JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || [];\n  const exercisesContainer = favoritesWrapper.querySelector('.cards-exercises');\n  const favoritesWrapperContainer =\n    favoritesWrapper.querySelector('.favorites-wrapper');\n  const messageContainer = favoritesWrapper.querySelector(\n    '.notification-message'\n  );\n\n  const removeExerciseFromUI = exerciseId => {\n    const cardItem = exercisesContainer.querySelector(\n      `.card-item[data-id=\"${exerciseId}\"]`\n    );\n\n    if (cardItem) {\n      exercisesContainer.removeChild(cardItem);\n    }\n  };\n\n  const isExistsFilter = exerciseId => {\n    const cardItem = exercisesContainer.querySelector(\n      `.card-item[data-id=\"${exerciseId}\"]`\n    );\n\n    return cardItem ? false : true;\n  };\n\n  // helpers\n  const removeById = exerciseId => {\n    try {\n      const exercisesFromStore =\n        JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || [];\n      const exercisesIds = exercisesFromStore.filter(id => id !== exerciseId);\n      state.exercisesIds = exercisesIds;\n      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(exercisesIds));\n      removeExerciseFromUI(exerciseId);\n      if (exercisesIds.length === 0) {\n        messageContainer.classList.add('vissible');\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const removeClickHandler = event => {\n    event.preventDefault();\n    const className = event.target.className;\n    const isTrashButton = className && className.includes('trash-link');\n\n    if (isTrashButton) {\n      const cardItem = getClosest(event.target, '.card-item');\n      if (cardItem && cardItem.dataset) {\n        removeById(cardItem.dataset.id);\n      }\n    }\n  };\n\n  const searchExercises = async exercisesIds => {\n    if (!exercisesIds || exercisesIds.length === 0) {\n      messageContainer.classList.add('vissible');\n      return;\n    }\n\n    messageContainer.classList.remove('vissible');\n\n    try {\n      clearContent(exercisesContainer);\n      showLoader(favoritesWrapperContainer);\n      const [...exercises] = await Promise.all(\n        exercisesIds.filter(isExistsFilter).map(id => Api.getExerciseById(id))\n      );\n      renderByExercises(exercises, exercisesContainer, true);\n    } catch (error) {\n      console.log(error);\n    } finally {\n      showLoader(favoritesWrapperContainer, true);\n    }\n  };\n\n  exercisesContainer.addEventListener('click', removeClickHandler);\n\n  document.addEventListener(UPDATE_LOCAL_STORAGE_EVENT, event => {\n    searchExercises(event.detail);\n  });\n\n  searchExercises(state.exercisesIds);\n})();\n"],"names":["favoritesWrapper","state","LOCAL_STORAGE_KEY","exercisesContainer","favoritesWrapperContainer","messageContainer","removeExerciseFromUI","exerciseId","cardItem","isExistsFilter","removeById","exercisesIds","id","error","removeClickHandler","event","className","getClosest","searchExercises","clearContent","showLoader","exercises","Api","renderByExercises","UPDATE_LOCAL_STORAGE_EVENT"],"mappings":"6HASC,IAAM,CACL,MAAMA,EAAmB,SAAS,cAAc,YAAY,EAC5D,GAAI,CAACA,EACH,OAGF,MAAMC,EAAQ,CACZ,aAAc,CAAE,CACpB,EAEEA,EAAM,aACJ,KAAK,MAAM,aAAa,QAAQC,CAAiB,CAAC,GAAK,GACzD,MAAMC,EAAqBH,EAAiB,cAAc,kBAAkB,EACtEI,EACJJ,EAAiB,cAAc,oBAAoB,EAC/CK,EAAmBL,EAAiB,cACxC,uBACJ,EAEQM,EAAuBC,GAAc,CACzC,MAAMC,EAAWL,EAAmB,cAClC,uBAAuBI,CAAU,IACvC,EAEQC,GACFL,EAAmB,YAAYK,CAAQ,CAE7C,EAEQC,EAAiBF,GAKd,CAJUJ,EAAmB,cAClC,uBAAuBI,CAAU,IACvC,EAMQG,EAAaH,GAAc,CAC/B,GAAI,CAGF,MAAMI,GADJ,KAAK,MAAM,aAAa,QAAQT,CAAiB,CAAC,GAAK,IACjB,OAAOU,GAAMA,IAAOL,CAAU,EACtEN,EAAM,aAAeU,EACrB,aAAa,QAAQT,EAAmB,KAAK,UAAUS,CAAY,CAAC,EACpEL,EAAqBC,CAAU,EAC3BI,EAAa,SAAW,GAC1BN,EAAiB,UAAU,IAAI,UAAU,CAE5C,OAAQQ,EAAO,CACd,QAAQ,IAAIA,CAAK,CAClB,CACL,EAEQC,EAAqBC,GAAS,CAClCA,EAAM,eAAc,EACpB,MAAMC,EAAYD,EAAM,OAAO,UAG/B,GAFsBC,GAAaA,EAAU,SAAS,YAAY,EAE/C,CACjB,MAAMR,EAAWS,EAAWF,EAAM,OAAQ,YAAY,EAClDP,GAAYA,EAAS,SACvBE,EAAWF,EAAS,QAAQ,EAAE,CAEjC,CACL,EAEQU,EAAkB,MAAMP,GAAgB,CAC5C,GAAI,CAACA,GAAgBA,EAAa,SAAW,EAAG,CAC9CN,EAAiB,UAAU,IAAI,UAAU,EACzC,MACD,CAEDA,EAAiB,UAAU,OAAO,UAAU,EAE5C,GAAI,CACFc,EAAahB,CAAkB,EAC/BiB,EAAWhB,CAAyB,EACpC,KAAM,CAAC,GAAGiB,CAAS,EAAI,MAAM,QAAQ,IACnCV,EAAa,OAAOF,CAAc,EAAE,IAAIG,GAAMU,EAAI,gBAAgBV,CAAE,CAAC,CAC7E,EACMW,EAAkBF,EAAWlB,EAAoB,EAAI,CACtD,OAAQU,EAAO,CACd,QAAQ,IAAIA,CAAK,CACvB,QAAc,CACRO,EAAWhB,EAA2B,EAAI,CAC3C,CACL,EAEED,EAAmB,iBAAiB,QAASW,CAAkB,EAE/D,SAAS,iBAAiBU,EAA4BT,GAAS,CAC7DG,EAAgBH,EAAM,MAAM,CAChC,CAAG,EAEDG,EAAgBjB,EAAM,YAAY,CACpC,GAAI"}